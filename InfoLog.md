Information Log
========
## Navigation
* [Setup](#setup)
    * [Setting up Github Repository](#github-repository)
    * [Technologies Used](#technologies-used)
* [Setting Up for JS](#setting-up-for-nodejs-and-expressjs)
    * [Installing JS modules](#installing)
    * [Creating a Basic app.js file](#basic-appjs)
* [Creating Our Basic Web App](#creating-our-basic-web-app)
    * [Getting HTML to appear](#getting-our-html-page-to-appear)
	* [Connecting to Database](#connecting-to-our-database)
* [Creating Basic API](#creating-basic-api-routing-and-responses)
	* [Routing to Our API](#routing-to-our-api)
	* [Writing orders.js (Part 1)](#ordersjs-part-1)
	* [Understanding REST](#understanding-what-were-doing)
* [Communicating With the Database](#communicating-with-the-database)
	* [Writing order.js](#orderjs)
	* [Writing orders.js (Part 2)](#ordersjs-part-2)
	* [Writing orders.js (Part 3)](#ordersjs-part-3)
* [Changing index.html](#modifying-the-original-code)
	* [Fetching Data](#fetching-data)
	* [Inserting New Data](#sending-post-data)
---
## Setup
### GitHub Repository
TLDR: I created a new git repository to hold my code and set up the files. [Here](https://docs.github.com/en/get-started/quickstart) is the quickstart guide, but I'll add the exact commands that need to be typed in.
- Create an empty folder for the project
- Go to [GitHub](https://github.com/) and create a new repository.
- Get the specific link for the project from GitHub
- If necessary, log in
- Open up a terminal or command line
```console
git init
git remote add origin (put the link gotten from GitHub here)
git branch -M main
```
- When a lot of code has been completed and it's time to save all the code, run these commands to save and log the code in GitHub
```console
git commit -m "(Put a message here that describes the work you did)"
git push -u origin main
```
- Then check in GitHub that it updated

### Technologies Used
- ChatGPT (obviously)
- Node JS (To run a JavaScript Web Application)
- Express JS (To create and access the very simple API to get the information)
- MongoDB (To hold our database)
- DigitalOcean (Web hosting)
---
## Setting Up for NodeJS and ExpressJS
### Installing
- First thing that has to happen is installing NodeJS. [Here](https://nodejs.org/en/download) is a link to download and install Node.
- Next, create a file called "app.js". Don't put anything in it yet, we'll get there.
- Run the following command. It will ask for subsequent information which should be very easy to provide. I recommend using the MIT license when it asks for one.
```console
npm init
```
- Next we install JavaScript modules
```console
npm i express
npm i mongoose
```
### Basic app.js
- Putting this basic code into our app.js file will now create a very simple website that prints "Hello, World!" to the screen. We'll link the Express JS app to the ChatGPT code in a moment.
```javascript
const express = require('express');
const app = express();
const port = 3000;

app.use(express.json());

app.route('/').get((req, res) => {
	res.send('Hello, World!');
});

app.listen(port, (error) => {
	if (error) {
		return console.log(`Server failed to start: ${error}.`);
	}
	console.log(`Server now accessible at http://localhost:${port}`);
});
```
- Now we need to run our web app. We can do this by typing the following into the terminal.
```console
node app.js
```
---
## Creating Our Basic Web App
### Getting our HTML page to appear
- Add the .html file generated by ChatGPT into your project. I put it inside another folder called static under the name index.html. (For the pure reason of convention)
- Once this is done, we are going to change our app.js file to include a few more.
```javascript
const express = require('express');
const app = express();
const port = 3000;
const path = require('path');

app.use(express.json());

app.route('/').get((req, res) => {
	/* Where it says "/static/index.html", make sure it points to where
       you put the html file generated by ChatGPT*/
	res.sendFile(path.join(__dirname + '/static/index.html'));
});

app.listen(port, (error) => {
	if (error) {
		return console.log(`Server failed to start: ${error}.`);
	}
	console.log(`Server now accessible at http://localhost:${port}`);
});
```
- The only changes are the addition of the line that says 
```const path = require('express');``` and changing the line that said ```res.send('Hello, World!');``` to what it is now.
### Connecting to our database
- We need to add some code which will connect your app to a MongoDB database
- The basic code for this will be derived form the [Mongoose documentation](https://mongoosejs.com/docs/)
- For that we just need to add a few lines after the line that says ```const path = require('path');```. The code below will create the connection.
```Javascript
const mongoose = require('mongoose');

main().catch((err) => console.log(err));

async function main() {
	//Make sure that where I wrote "orders" you write whatever you want the name of the database you are storing to be.
	await mongoose.connect('mongodb://localhost/orders');
}
```
---
## Creating Basic API Routing and Responses
### Routing to our API
- First create a new folder named "routes". Then inside put a file named "orders.js" or something similar to match the specifications of your project.
- Next add this code below where the routing for the main page that the user accesses
```Javascript
const ordersRouter = require('./routes/orders');
app.use('/orders', ordersRouter);
```
### orders.js (Part 1)
- This file is going to contain the logic that allows the web to communicate with the database.
- We are going to create some filled code, which will allow us to test if our routing is working. Put the following code into "orders.js".
```Javascript
const express = require('express');
const router = express.Router();

router.get('/', (req, res) => {
	res.send('Hello, World!');
});

module.exports = router;
```
### Understanding what we're doing
- [Here](https://www.codecademy.com/article/what-is-rest) is a link to a page explaining for a REST API works. More specifically, it explains some of the terminology.
- Stuff is about to get somewhat weird if you don't understand this stuff, so if you want to actually understand what you are doing instead of just copy and pasting the code, I would recommend reading that.
---
## Communicating With the Database
### order.js
- I know it may seem weird that we have two files with nearly the same name, but they're in different folders, so my laziness is excused
- We will now create a new folder called "models" and inside this folder we will create a file called "order.js". Again, or whatever you are making.
- This file is going to define the schema for the database, so that it actually understands what an order is. Here is the code
```Javascript
const mongoose = require('mongoose');

const orderSchema = new mongoose.Schema({
	orderNumber: {
		type: String,
		required: true,
	},
	dateCreated: {
		type: String,
		required: true,
	},
	description: {
		type: String,
		required: true,
	},
	teamCode: {
		type: String,
		required: true,
	},
	dateClosed: {
		type: String,
		required: true,
	},
});

module.exports = mongoose.model('Order', orderSchema);
```
- The order is stored as a JSON (aka Javascript Object Notation). For more info on understanding the format see [here](https://www.json.org/json-en.html).
- Where is says "String", that just means plain text
- The ```module.exports``` statement makes it so when we eventually reference this schema in orders.js, it will understand what we are saying.
### orders.js (Part 2)
- We will now be updating the code in orders.js, so return to that file
- This will now allow the API to return all of our existing change orders.
```Javascript
//Imports
const express = require('express');
const router = express.Router();
const Order = require('../models/order.js');

//Route for getting all documents
router.get('/', async (req, res) => {
	try {
		//This gets all the change orders and send them back in JSON format
		const orders = await Order.find();
		res.json(orders);
	} catch (error) {
		//This means that there is an erorr, and we must send back an error message
		res.status(500).json({ message: error });
	}
});

module.exports = router;
```
- This uses async/await to get the information from the database. That is not necessarily required to understand this. As long as the words "async" and "await" are in the right spots, it will be fine. If you wanna learn about it [here](https://www.youtube.com/watch?v=V_Kr9OSfDeU) is a video that explains it.
- There should presently be no data in the database, since we haven't made the create function yet, but we can now access our lack of data, which will soon be full of many change orders.
### orders.js (Part 3)
- We are now going to create the API path for creating a new document in the database.
- This will be done in a slightly similar way to the get all doucuments request from before. The code below shows the process.
```Javascript
//Route for creating a document
router.post('/', async (req, res) => {
	//Creating a new change order object out of data received in the post request
	const order = new Order({
		orderNumber: req.body.orderNumber,
		dateCreated: req.body.dateCreated,
		description: req.body.description,
		teamCode: req.body.teamCode,
		dateClosed: req.body.dateClosed,
	});
	//We will now try inserting the new order into the database
	try {
		const newOrder = await order.save();
		res.status(201).json(newOrder);
	} catch (error) {
		res.status(400).json({ message: error.message });
	}
});
```
- Now I gotta explain this thing... Oh gosh.
- So, once again, we are using an async/await system for interacting with the database
- We are using the format "req.body.(dataName)" to get the data from the POST request being sent into the API
- The object called "order" is what we are storing all of this data inside. It takes the form of the Order schema from "order.js", which means the database will recognize what it is.
- Those fun little numbers in "res.status" are status codes. For more info click [here](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status).
---
## Modifying the Original Code
### Fetching data
- FINALLY, we have created the database, and now we will be able to fetch our data and put it on the change order log.
- We will not be modifying the HTML in the main file (yet), but we will be changing the JavaScript at the very end of the file. We will only be modifying with is within the ```<script>``` tag.
- We are going to be moving the code that creates a new row in the orders table into a new function. This code is going to be moved into a new function. We'll be deleting the old code in a moment. Put the following code immediately after where it says ```<script>```.
```JavaScript
    function makeNewRow(orderNumber, dateCreated, description, teamCode, dateClosed) {
      const newRow = document.createElement('tr');
      newRow.innerHTML = `
        <td>${orderNumber}</td>
        <td>${dateCreated}</td>
 		<td>${description}</td>
        <td>${teamCode}</td>
        <td>${dateClosed}</td>
      `;

      document.getElementById('changeOrderLog').appendChild(newRow);
    }
    async function fetchAPI() {
      const response = await fetch("http://localhost:3000/orders");
      const jsonData = await response.json();
      jsonData.forEach(data => {
        makeNewRow(data.orderNumber, data.dateCreated, data.description, data.teamCode, data.dateClosed);
      });
    }
    fetchAPI();
```
- Once again, I must explain... yay....... The function takes in all the data needed for the new row. Then it creates a new element with all the data it needs, and then it puts them inside the table.
- Then the asynchronous function fetchAPI uses async/await to get all the data from the database, and then for each entry, creating a new row.
- This won't actually show anything yet, cause we haven't added anything into the database yet
### Sending Post Data
- This will be the last programming that we have to do.
- We will be making it so the "Add Change Order" form actually saves data to the database
- We will start by creating a new async function. See below
```Javascript
    async function insertRowIntoDB(orderNumber, dateCreated, description, teamCode, dateClosed) {
      const response = await fetch("http://localhost:3000/orders", {
        method: "POST",
        body: JSON.stringify({
          orderNumber: orderNumber,
          dateCreated: dateCreated,
          description: description,
          teamCode: teamCode,
          dateClosed: dateClosed
        }),
        headers: {
          "Content-type": "application/json; charset=UTF-8"
        }
      })
        .then((response) => response.json())
        .then((json) => console.log(json));
    }
```
- This function takes parameters of all the data we need, creates a new JSON with all of that data, and sends it as a post request to our database.
- Next we need to change what is inside the event listener for the "Add Change Order" function. See below. Change the existing code to this.
```Javascript
    document.getElementById('changeOrderForm').addEventListener('submit', function (event) {
      event.preventDefault();
      makeNewRow(orderNumber.value, dateCreated.value, description.value, teamCode.value, dateClosed.value);
      insertRowIntoDB(orderNumber.value, dateCreated.value, description.value, teamCode.value, dateClosed.value);

      // clear input fields after submit
      document.getElementById('orderNumber').value = '';
      document.getElementById('dateCreated').value = '';
      document.getElementById('description').value = '';
      document.getElementById('teamCode').value = '';
      document.getElementById('dateClosed').value = '';
    });
```
- This should enable us to create a new entry into the database.
- This is all the programming required for the project.
---